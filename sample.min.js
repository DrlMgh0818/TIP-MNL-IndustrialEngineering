function getBlockVertices(t,i){let s=[],e=[],h=~~(i.width/t),n=i.width-t*h;horizontalOffset=n/2;let o=~~(i.height/t),l=i.height-t*o;for(verticalOffset=l/2;;){for(let h=verticalOffset;h<i.height;h+=t)if(!(h+t>i.height))for(let n=horizontalOffset;n<i.width;n+=t)n+t>i.width||(coinFlipIsAllHeads(1)?s.push({x:n,y:h}):coinFlipIsAllHeads(4)&&e.push({x:n,y:h}));if(e.length>0)break}return{blocks:s,balls:e}}function coinFlipIsAllHeads(t){let i=!0;for(let s=0;s<t;s++)if(Math.random()<=.5){i=!1;break}return i}function getBrowserWindowSize(){let t=window,i=document,s=20,e=i.documentElement,h=i.getElementsByTagName("body")[0],n=t.innerWidth||e.clientWidth||h.clientWidth,o=t.innerHeight||e.clientHeight||h.clientHeight;return{width:n-s,height:o-s}}function setNewGrid(){let t=getBrowserWindowSize();createCanvas(t.width,t.height);let i=getBlockVertices(blockLength,t),s=i.blocks,e=i.balls;blocks=[],s.forEach(function(t){blocks.push(new Block(t.x,t.y,blockLength))}),balls=[],e.forEach(function(i){balls.push(new Ball(i.x,i.y,blocks,t.width,t.height))}),balls.forEach(function(t){t.setBalls(balls)})}function setup(){let t=getBrowserWindowSize();createCanvas(t.width,t.height);let i=getBlockVertices(blockLength,t),s=i.blocks,e=i.balls;s.forEach(function(t){blocks.push(new Block(t.x,t.y,blockLength))}),e.forEach(function(i){balls.push(new Ball(i.x,i.y,blocks,t.width,t.height))}),balls.forEach(function(t){t.setBalls(balls)}),background(backgroundColor),document.addEventListener("click",t=>{setNewGrid()}),window.addEventListener("resize",function(){let t=getBrowserWindowSize();resizeCanvas(t.width,t.height),setNewGrid(),background(backgroundColor)})}function draw(){background(backgroundColor),[...balls].forEach(function(t){t.update()}),[...blocks,...balls].forEach(function(t){t.draw()})}let blocks=[],balls=[],lines=[],blockLength=50,horizontalOffset=0,verticalOffset=0,backgroundColor="rgba(2,45,74,1)";class Block{constructor(t,i,s){this.x=t,this.y=i,this.length=s,this.lines=[],this.points=[],this.activePoints=[],this.setPoints(),this.setActivePoints()}startBlinking(){this.lines.forEach(function(t,i){t.startBlinking()})}setPoints(){this.points=[{x:this.x,y:this.y},{x:this.x+this.length,y:this.y},{x:this.x+this.length,y:this.y+this.length},{x:this.x,y:this.y+this.length},{x:this.x+this.length/2,y:this.y+this.length/2}]}setActivePoints(){this.activePoints=[];let t=this.randomIntFromInterval(0,this.points.length-1);for(this.activePoints.push(this.points[t]);this.activePoints.length<2;){var i;for(i=0;i<4;i++){t=this.randomIntFromInterval(0,this.points.length-1);let i=this.points[t];this.containsObject(i,this.activePoints)||this.activePoints.push(i)}}this.setLines()}getLines(){return this.lines}setLines(){this.lines=[];for(let t=0;t<this.activePoints.length-1;t++){let i=this.activePoints[t],s=this.activePoints[t+1];this.lines.push(new Line(i,s))}}containsObject(t,i){var s;for(s=0;s<i.length;s++)if(i[s]===t)return!0;return!1}draw(){this.lines.forEach(function(t){t.draw()})}randomIntFromInterval(t,i){return Math.floor(Math.random()*(i-t+1)+t)}update(){}}class Line{constructor(t,i){this.p1=t,this.p2=i,this.strokeColor="#0691ee",this.color="#e5edf3",this.radius=10,this.blinking=!1,this.maxCounter=100,this.blinkCounter=0}startBlinking(){this.blinking=!0}randomIntFromInterval(t,i){return Math.floor(Math.random()*(i-t+1)+t)}draw(){this.blinking&&(this.blinkCounter++,noStroke(),this.blinkCounter%12==0?fill("#f6ee07"):fill("#676303"),circle(this.p1.x,this.p1.y,2*this.radius),noFill(),this.blinkCounter>this.maxCounter&&(this.blinkCounter=0,this.blinking=!1)),stroke(this.strokeColor),strokeWeight(2),line(this.p2.x,this.p2.y,this.p1.x,this.p1.y),fill(this.color),circle(this.p1.x,this.p1.y,this.radius),fill(this.color),circle(this.p2.x,this.p2.y,this.radius)}}class Ball{constructor(t,i,s,e,h){this.x=t,this.y=i,this.blocks=s,this.screenWidth=e,this.screenHeight=h,this.xOld=this.x,this.yOld=this.y,this.radius=12,this.unitDistance=5,this.balls,this.speed=this.getStartingVelocity(),this.numOfDirections=16,this.activeDirection=this.randomIntFromInterval(1,this.numOfDirections),this.distanceMoved=0,this.maxDistance=25,this.lineLength=10,this.color="#000c16",this.tail={x:this.x,y:this.y}}setActiveDirection(){let t=this.activeDirection;for(;this.activeDirection=this.randomIntFromInterval(1,this.numOfDirections),t==this.activeDirection;);this.distanceMoved=0,this.tail={x:this.x,y:this.y}}moveInActiveDirection(){switch(this.activeDirection){case 1:this.moveUp();break;case 2:this.moveDown();break;case 3:this.moveRight();break;case 4:this.moveLeft();break;case 5:this.moveUpRight();break;case 6:this.moveUpLeft();break;case 7:this.moveDownRight();break;case 8:this.moveDownLeft();break;case 9:case 10:case 11:case 12:this.moveRight();break;case 13:case 14:this.moveDown();break;default:this.moveDown()}}randomIntFromInterval(t,i){return Math.floor(Math.random()*(i-t+1)+t)}getStartingVelocity(){let t=Math.random()>.5?-this.unitDistance:this.unitDistance,i=Math.random()>.5?-this.unitDistance:this.unitDistance;return{x:t,y:i}}isTouchingLeftWall(){return this.x-this.radius<=0}isTouchingRightWall(){return this.x+this.radius>=this.screenWidth}isTouchingCeiling(){return this.y-this.radius<=0}isTouchingFloor(){return this.y+this.radius>=this.screenHeight}checkWallCollision(){switch(!0){case this.isTouchingLeftWall():this.x=this.radius+1,this.setActiveDirection();break;case this.isTouchingRightWall():this.x=this.screenWidth-this.radius-1,this.setActiveDirection();break;case this.isTouchingFloor():this.y=this.screenHeight-this.radius-1,this.setActiveDirection();break;case this.isTouchingCeiling():this.y=this.radius+1,this.setActiveDirection()}}checkBallCollision(){for(let t=0;t<this.balls.length;t++){let i=this.balls[t];if(this.hasTouchedAnotherBall(i)){this.x=this.xOld-this.unitDistance,this.y=this.yOld-this.unitDistance,this.setActiveDirection();break}}}hasTouchedAnotherBall(t){if(t.x==this.x&t.y==this.y)return!1;if(Math.abs(t.x-this.x)>t.radius||Math.abs(t.y-this.y)>t.radius)return!1;let i=Math.pow(this.x-t.x,2),s=Math.pow(this.y-t.y,2),e=Math.sqrt(i+s);return e<=this.radius}checkLineCollision(){this.x,this.y;let t=!1;for(let i=0;i<this.blocks.length;i++){let s=this.blocks[i],e=s.getLines();for(let h=0;h<e.length;h++){let n=e[h],o={x:this.x,y:this.y};if(this.hasTouchedALine(n.p1,n.p2,o,this.radius)){this.x=this.xOld-this.unitDistance,this.y=this.yOld-this.unitDistance,this.setActiveDirection(),s.setActivePoints(),this.blocks[i].startBlinking(),t=!0;break}}if(t)break}}setBalls(t){this.balls=t}hasTouchedALine(t,i,s,e){var h;const n=i.x-t.x,o=i.y-t.y,l=s.x-t.x,a=s.y-t.y,r=(l*n+a*o)/(o*o+n*n);return h=r>=0&&r<=1?(t.x+n*r-s.x)**2+(t.y+o*r-s.y)**2:r<0?(t.x-s.x)**2+(t.y-s.y)**2:(i.x-s.x)**2+(i.y-s.y)**2,h<e*e}moveUp(){this.x+=0,this.speed.y>=0&&(this.speed.y=-this.unitDistance),this.y+=this.speed.y}moveDown(){this.x+=0,this.speed.y<=0&&(this.speed.y=this.unitDistance),this.y+=this.speed.y}moveRight(){this.y+=0,this.speed.x<=0&&(this.speed.x=this.unitDistance),this.x+=this.speed.x}moveLeft(){this.y+=0,this.speed.x>=0&&(this.speed.x=-this.unitDistance),this.x+=this.speed.x}moveUpRight(){this.speed.x<=0&&(this.speed.x=this.unitDistance),this.speed.y>=0&&(this.speed.y=-this.unitDistance),this.x+=this.speed.x,this.y+=this.speed.y}moveUpLeft(){this.speed.x>=0&&(this.speed.x=-this.unitDistance),this.speed.y>=0&&(this.speed.y=-this.unitDistance),this.x+=this.speed.x,this.y+=this.speed.y}moveDownRight(){this.speed.x<=0&&(this.speed.x=this.unitDistance),this.speed.y<=0&&(this.speed.y=this.unitDistance),this.x+=this.speed.x,this.y+=this.speed.y}moveDownLeft(){this.speed.x>=0&&(this.speed.x=-this.unitDistance),this.speed.y<=0&&(this.speed.y=this.unitDistance),this.x+=this.speed.x,this.y+=this.speed.y}update(){this.xOld=this.x,this.yOld=this.y,this.moveInActiveDirection(),this.checkWallCollision(),this.checkBallCollision(),this.checkLineCollision(),this.distanceMoved+=this.unitDistance,this.distanceMoved>=this.maxDistance&&this.setActiveDirection()}draw(){noStroke(),fill("rgba(244, 208, 63,1)"),circle(this.x,this.y,this.radius),fill("rgba(0,0,0,1)"),circle(this.x,this.y,this.radius/2),fill("rgba(244, 208, 63,1)"),circle(this.tail.x,this.tail.y,this.radius/2),fill("rgba(0,0,0,1)"),circle(this.tail.x,this.tail.y,this.radius/4),stroke("black"),strokeWeight(2),line(this.x,this.y,this.tail.x,this.tail.y)}}